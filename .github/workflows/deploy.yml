name: Deploy to Render

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  notify-deployment:
    runs-on: ubuntu-latest

    steps:
    - name: Notify deployment started
      run: |
        echo "üöÄ Deployment to Render started automatically"
        echo "Render will automatically deploy when push to main branch is detected"
        echo "Check Render dashboard for deployment status"

    - name: Wait for Render deployment
      run: |
        echo "‚è≥ Waiting for Render to complete deployment..."
        sleep 30  # Give Render time to start deployment

        # Check deployment status (optional - requires Render API key)
        # This is just for notification purposes
        echo "üìä Monitor deployment at: https://dashboard.render.com"

    - name: Health check after deployment
      run: |
        echo "üîç Waiting for deployment to complete..."
        sleep 120  # Wait longer for Render deployment

        # Health check (adjust URL to your actual Render URL)
        response=$(curl -s -o /dev/null -w "%{http_code}" https://your-app.onrender.com/health 2>/dev/null || echo "000")

        if [ "$response" = "200" ]; then
          echo "‚úÖ Deployment successful - health check passed"
        elif [ "$response" = "000" ]; then
          echo "‚ö†Ô∏è Could not reach health endpoint - check Render dashboard"
        else
          echo "‚ö†Ô∏è Health check returned $response - deployment may need more time"
        fi
